<ion-content fullscreen>
  <div class="header-svg-container">
    <svg xmlns="http://www.w3.org/2000/svg" width="412" height="365" viewBox="0 0 412 365" fill="none">
      <path d="M-35 -18H621V365C433.901 115.251 174.347 172.943 -35 365V-18Z" fill="#9C3FC3"/>
    </svg>

    <img [src]="categoriaImagem" alt="Categoria" class="categoria-header-img" />
    <p class="categoria-header-text">{{ categoriaTexto }}</p>
  </div>

  <ion-button class="audio-btn" fill="solid" (click)="toggleAudio()">
    <ion-icon name="volume-high" slot="icon-only"></ion-icon>
  </ion-button>

  <audio class="audio-scss" #audioPlayer [src]="flashcardAtual?.audioPergunta" controls style="display: none;"></audio>

  <div class="flashcard" [class.flip]="mostrarResposta" *ngIf="flashcardAtual">
    <div class="flashcard-inner">
      
      <!-- FRENTE -->
      <div class="flashcard-front">
        <ion-button class="editar-btn" fill="clear" (click)="editarFlashcard(flashcardAtual!)">
          <img src="../../assets/img/gerenciar_flashcards.png" alt="Editar">
          <span>Editar</span>
        </ion-button>
        <br>

        <!-- Mostrar categoria real (apenas em Minhas Memórias) 
        <div class="flashcard-categoria-info" *ngIf="isMinhasMemorias">
          <small>Categoria: {{ getCategoriaFlashcard(flashcardAtual) }}</small>
        </div>
        -->
        
        <div class="flashcard-titulo-container">
          <h2 class="flashcard-titulo">{{ flashcardAtual.tituloFlashcard }}</h2>
        </div>

        <div class="flashcard-conteudo">
          <!-- Mídia Auxiliar -->
          <img
            *ngIf="getMidiaAuxiliarTipo(flashcardAtual) === 'image' && isMidiaValida(flashcardAtual.midiaAuxiliar)"
            [src]="flashcardAtual.midiaAuxiliar"
            alt="Mídia Auxiliar"
            class="flashcard-midia-img"
            (error)="onImageError($event)" />

          <video
            *ngIf="getMidiaAuxiliarTipo(flashcardAtual) === 'video' && isMidiaValida(flashcardAtual.midiaAuxiliar)"
            [src]="flashcardAtual.midiaAuxiliar"
            controls
            class="flashcard-midia-video">
            Seu navegador não suporta o elemento de vídeo.
          </video>

          <audio
            *ngIf="getMidiaAuxiliarTipo(flashcardAtual) === 'audio' && isMidiaValida(flashcardAtual.midiaAuxiliar)"
            [src]="flashcardAtual.midiaAuxiliar"
            controls
            class="flashcard-audio">
            Seu navegador não suporta o elemento de áudio.
          </audio>

          <p *ngIf="!flashcardAtual.midiaAuxiliar" class="flashcard-sem-midia">
            Nenhuma mídia auxiliar adicionada.
          </p>
        </div>

        <div class="flashcard-audio">
          <audio
            class="flashcard-audio"
            [src]="flashcardAtual.audioPergunta"
            controls
            *ngIf="isMidiaValida(flashcardAtual.audioPergunta)">
          </audio>
          <p *ngIf="!isMidiaValida(flashcardAtual.audioPergunta)" class="flashcard-sem-midia">
            Áudio da pergunta não disponível
          </p>
        </div>
      </div>

      <!-- VERSO -->
      <div class="flashcard-back">
        <ion-button class="editar-btn" fill="clear" (click)="editarFlashcard(flashcardAtual!)">
          <img src="../../assets/img/gerenciar_flashcards.png" alt="Editar">
          <span>Editar</span>
        </ion-button>

        <div class="flashcard-titulo-container">
          <h2 class="flashcard-titulo">{{ flashcardAtual.tituloFlashcard }}</h2>
        </div>

        <div class="flashcard-conteudo">
          <!-- Mídia Auxiliar (mesma da frente) -->
          <img
            *ngIf="getMidiaAuxiliarTipo(flashcardAtual) === 'image' && isMidiaValida(flashcardAtual.midiaAuxiliar)"
            [src]="flashcardAtual.midiaAuxiliar"
            alt="Mídia Auxiliar"
            class="flashcard-midia-img"
            (error)="onImageError($event)" />

          <video
            *ngIf="getMidiaAuxiliarTipo(flashcardAtual) === 'video' && isMidiaValida(flashcardAtual.midiaAuxiliar)"
            [src]="flashcardAtual.midiaAuxiliar"
            controls
            class="flashcard-midia-video">
            Seu navegador não suporta o elemento de vídeo.
          </video>

          <audio
            *ngIf="getMidiaAuxiliarTipo(flashcardAtual) === 'audio' && isMidiaValida(flashcardAtual.midiaAuxiliar)"
            [src]="flashcardAtual.midiaAuxiliar"
            controls
            class="flashcard-audio">
            Seu navegador não suporta o elemento de áudio.
          </audio>

          <p *ngIf="!flashcardAtual.midiaAuxiliar" class="flashcard-sem-midia">
            Nenhuma mídia auxiliar adicionada.
          </p>
        </div>

        <!-- Curiosidade -->
        <div class="curiosidade-btn-container" *ngIf="flashcardAtual.curiosidade">
          <ion-button class="curiosidade-btn" fill="clear" (click)="abrirCuriosidade()">
            <span class="material-icons">maps_ugc</span>
          </ion-button>
          <p class="curiosidade-texto">Curiosidade</p>
        </div>

        <div class="curiosidade-tela" *ngIf="mostrarCuriosidade">
          <div class="curiosidade-conteudo">
            <p>{{ flashcardAtual.curiosidade }}</p>
            <ion-button class="fechar-curiosidade-btn" fill="solid" (click)="fecharCuriosidade()">Voltar</ion-button>
          </div>
        </div>

        <div class="flashcard-audio">
          <audio
            class="flashcard-audio"
            [src]="flashcardAtual.audioResposta"
            controls
            *ngIf="isMidiaValida(flashcardAtual.audioResposta)">
          </audio>
          <p *ngIf="!isMidiaValida(flashcardAtual.audioResposta)" class="flashcard-sem-midia">
            Áudio da resposta não disponível
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Mensagem quando não há flashcards -->
  <div *ngIf="!flashcardAtual" class="empty-state">
    <p class="flashcard-sem-midia">Não há flashcards {{ isMinhasMemorias ? 'nas suas memórias' : 'para esta categoria' }}.</p>
    <!-- Tela menina ? -->
  </div>

  <!-- Botões de ação -->
  <div class="botoes-container" *ngIf="flashcardAtual">
    <div class="botao-com-texto">
      <ion-button class="btn-circular" (click)="verResposta()">
        <img [src]="mostrarResposta ? '../../assets/img/redo-btn.png' : '../../assets/img/ver-resposta-btn.png'"
             [alt]="mostrarResposta ? 'Repetir' : 'Ver resposta'">
      </ion-button>
      <p *ngIf="!mostrarResposta">Resposta</p>
      <p *ngIf="mostrarResposta">Repetir</p>
    </div>

    <div class="botao-com-texto">
      <ion-button class="btn-retangular" (click)="mostrarAlertaConfirmacao()">
        <img src="../../assets/img/delete-btn.png" alt="Deletar">
      </ion-button>
      <p>Deletar</p>
    </div>

    <div class="botao-com-texto">
      <ion-button class="btn-circular" (click)="proximo()">
        <img src="../../assets/img/foward-btn.png" alt="Próximo">
      </ion-button>
      <p>Próximo</p>
    </div>
  </div>

  <div *ngIf="mostrarJanela"class="overlay" (click)="fecharJanelaMais()"></div>

  <div *ngIf="mostrarJanela" class="janela-mais-opcoes" (click)="$event.stopPropagation()">
    <ion-button class="janela-mais-config-btn">
      <div class="janela-mais-config-btn-div">
        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 60 60" fill="none">
          <path d="M36.4336 5.5L37.416 13.3594L37.6953 13.4668C38.21 13.6647 38.6938 13.9012 39.1465 14.1768C39.6139 14.4612 40.0712 14.7664 40.5186 15.0918L40.7461 15.2578L41.0059 15.1484L48.0371 12.1934L54.4707 23.3057L48.3857 27.9141L48.1514 28.0918L48.1924 28.3828C48.231 28.6531 48.25 28.911 48.25 29.1562V30.8438C48.25 31.0628 48.2165 31.2977 48.1445 31.5498L48.0498 31.8789L48.3232 32.0859L54.4082 36.6934L47.9756 47.8047L41.0078 44.8525L40.7471 44.7422L40.5186 44.9082C40.0741 45.2315 39.6089 45.535 39.123 45.8184C38.641 46.0995 38.1607 46.3389 37.6826 46.5381L37.415 46.6504L37.3789 46.9375L36.4336 54.5H23.5664L22.584 46.6406L22.3047 46.5332L21.9248 46.3779C21.5503 46.2148 21.1932 46.03 20.8535 45.8232C20.3861 45.5388 19.9288 45.2336 19.4814 44.9082L19.2539 44.7422L18.9941 44.8516L11.9619 47.8057L5.52832 36.6934L11.6143 32.0859L11.8496 31.9082L11.8076 31.6172C11.769 31.3469 11.75 31.089 11.75 30.8438V29.1562C11.75 28.911 11.769 28.6531 11.8076 28.3828L11.8496 28.0918L11.6143 27.9141L5.52832 23.3057L11.9619 12.1934L18.9941 15.1484L19.2539 15.2578L19.4814 15.0918C19.9259 14.7685 20.3911 14.465 20.877 14.1816C21.359 13.9005 21.8393 13.6611 22.3174 13.4619L22.585 13.3496L22.6211 13.0625L23.5664 5.5H36.4336ZM27.0664 9.93457L26.2344 16.2305C25.0243 16.571 23.8929 17.0474 22.8418 17.6621C21.796 18.2738 20.8323 19.0039 19.9502 19.8496L14.0664 17.4131L13.6602 17.2451L13.4414 17.626L11.0039 21.876L10.7832 22.2607L11.1387 22.5264L16.2295 26.3154C16.0692 26.8536 15.951 27.3927 15.8789 27.9336C15.7923 28.583 15.75 29.2722 15.75 30C15.75 30.6875 15.7925 31.3558 15.8789 32.0039C15.9512 32.5457 16.0697 33.0859 16.2305 33.625L11.1357 37.4766L10.7842 37.7412L11.0039 38.124L13.4414 42.374L13.6621 42.7588L14.0703 42.585L19.9453 40.0918C20.8282 40.974 21.7929 41.7244 22.8418 42.3379C23.8919 42.9521 25.0226 43.4271 26.2314 43.7676L27.0039 50.0605L27.0576 50.5H32.876L32.9336 50.0654L33.7646 43.7686C34.9751 43.428 36.1078 42.9528 37.1592 42.3379C38.2048 41.7263 39.1668 40.995 40.0488 40.1494L45.9336 42.5869L46.3398 42.7549L46.5586 42.374L48.9961 38.124L49.2158 37.7412L48.8643 37.4766L43.7725 33.6279C43.9315 33.1161 44.0499 32.585 44.1211 32.0332C44.2072 31.3657 44.25 30.6876 44.25 30C44.25 29.3124 44.2072 28.6343 44.1211 27.9668C44.0498 27.4147 43.9316 26.8832 43.7725 26.3711L48.8643 22.5234L49.2158 22.2588L48.9961 21.876L46.5586 17.626L46.3379 17.2412L45.9297 17.415L40.0537 19.9072C39.1712 19.0255 38.2075 18.2753 37.1592 17.6621C36.1086 17.0476 34.977 16.572 33.7676 16.2314L32.9961 9.93945L32.9424 9.5H27.124L27.0664 9.93457ZM30.125 21.75C32.4091 21.75 34.3445 22.5515 35.959 24.166C37.5735 25.7806 38.375 27.7159 38.375 30C38.375 32.2841 37.5735 34.2194 35.959 35.834C34.3445 37.4485 32.4091 38.25 30.125 38.25C27.7968 38.25 25.8528 37.4467 24.2617 35.8359C22.6675 34.2219 21.875 32.286 21.875 30C21.875 27.714 22.6675 25.7781 24.2617 24.1641C25.8528 22.5533 27.7968 21.75 30.125 21.75Z" fill="white" stroke="black"/>
        </svg>
        <div class="janela-mais-config-btn-texto">
          Config.
        </div>
      </div>
    </ion-button>

    <ion-button class="janela-mais-site-btn">
      <div class="janela-mais-site-btn-div">
        <svg xmlns="http://www.w3.org/2000/svg" width="50" height="44" viewBox="0 0 50 44" fill="none">
          <path d="M5 0.5448H45C46.2461 0.5448 47.2976 0.970376 48.1826 1.82898C49.0672 2.68712 49.5 3.70015 49.5 4.89539V31.5751C49.4999 32.7702 49.0671 33.7834 48.1826 34.6415C47.2976 35.5 46.2461 35.9257 45 35.9257H36.2666L37.1514 36.7841L39.5 39.0624V43.201H10.5V39.0624L12.8486 36.7841L13.7334 35.9257H5C3.75392 35.9257 2.7024 35.5 1.81738 34.6415C0.932903 33.7834 0.500102 32.7702 0.5 31.5751V4.89539C0.500039 3.70015 0.932838 2.68712 1.81738 1.82898C2.70242 0.970376 3.75386 0.5448 5 0.5448ZM4.5 32.0751H45.5V4.39539H4.5V32.0751Z" fill="white" stroke="black"/>
        </svg>
        <div class="janela-mais-site-btn-texto">
          Ir para o Site
        </div>
      </div>
    </ion-button>
  </div>

  <div *ngIf="mostrarConfirmacao" class="alerta-confirmacao">
      <div class="alerta-confirmacao-texto">
        Tem certeza que deseja excluir?
      </div>
      <div class="alerta-confirmacao-btns">
        <ion-button class="alerta-confirmacao-sim-btn" (click)="confirmarExclusao()">
          SIM
        </ion-button>
        <ion-button (click)="naoExcluir()" class="alerta-confirmacao-nao-btn">
          NÃO
        </ion-button>
      </div>
    </div>

    <div *ngIf="mostrarMensagemSucesso" class="alerta-confirmacao-sucesso">
      Exclusão feita com sucesso
    </div>

  <ion-footer class="flashcard-footer">
    <ion-button class="voltar-btn" (click)="voltar2()">
      <div class="voltar-btn-div">
        <div class="voltar-svg">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
            <path d="M15.65 26L26.85 37.2L24 40L8 24L24 8L26.85 10.8L15.65 22H40V26H15.65Z" fill="#737373"/>
          </svg>
        </div>
        <div class="voltar-texto">
          <p class="voltar">Voltar</p>
        </div>
      </div>
    </ion-button>

    <ion-button class="inicio-btn" (click)="inicio()">
      <div class="inicio-btn-div">
        <div class="inicio-svg">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
            <path d="M10 40V21.7L4.4 26L2 22.8L24 6L32 12.1V8H38V16.7L46 22.8L43.6 26L38 21.7V40H26V28H22V40H10ZM14 36H18V24H30V36H34V18.65L24 11.05L14 18.65V36ZM20 20.05H28C28 18.9833 27.6 18.1083 26.8 17.425C26 16.7417 25.0667 16.4 24 16.4C22.9333 16.4 22 16.7417 21.2 17.425C20.4 18.1083 20 18.9833 20 20.05Z" fill="#737373"/>
          </svg>
        </div>
       <div class="inicio-texto">
        <p class="inicio">Início</p>
       </div>
      </div>
    </ion-button>

    <ion-button (click)="mostrarJanelaMais()" class="mais-btn-1">
      <div class="mais-btn-div-1">
        <div class="mais-svg-1">
          <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 48 48" fill="none">
            <path d="M12 28C10.9 28 9.95833 27.6083 9.175 26.825C8.39167 26.0417 8 25.1 8 24C8 22.9 8.39167 21.9583 9.175 21.175C9.95833 20.3917 10.9 20 12 20C13.1 20 14.0417 20.3917 14.825 21.175C15.6083 21.9583 16 22.9 16 24C16 25.1 15.6083 26.0417 14.825 26.825C14.0417 27.6083 13.1 28 12 28ZM24 28C22.9 28 21.9583 27.6083 21.175 26.825C20.3917 26.0417 20 25.1 20 24C20 22.9 20.3917 21.9583 21.175 21.175C21.9583 20.3917 22.9 20 24 20C25.1 20 26.0417 20.3917 26.825 21.175C27.6083 21.9583 28 22.9 28 24C28 25.1 27.6083 26.0417 26.825 26.825C26.0417 27.6083 25.1 28 24 28ZM36 28C34.9 28 33.9583 27.6083 33.175 26.825C32.3917 26.0417 32 25.1 32 24C32 22.9 32.3917 21.9583 33.175 21.175C33.9583 20.3917 34.9 20 36 20C37.1 20 38.0417 20.3917 38.825 21.175C39.6083 21.9583 40 22.9 40 24C40 25.1 39.6083 26.0417 38.825 26.825C38.0417 27.6083 37.1 28 36 28Z" fill="#737373"/>
          </svg>
        </div>
        <div class="mais-texto-1">
          <p>Mais</p>
        </div>
      </div>
    </ion-button>
  </ion-footer>
</ion-content>